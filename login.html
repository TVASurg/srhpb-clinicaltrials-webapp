<!DOCTYPE html>

<html lang="en">

<head>
  <title>GI clinical trials webapp - powered by the Schwartz Reisman HPB Research Innovation Centre - TVASurg - v.13</title>

  <meta name="robots" content="noindex">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="" />

  <link rel="stylesheet" href="./style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <link rel="icon" href="favicon.jpg">

  <!-- Auth0 Lock CDN (14.1) -->
  <script src="https://cdn.auth0.com/js/lock/14.1/lock.min.js"></script> 
  
</head> 

<body>

  <main class="container">
    <nav class="navbar sticky-top navbar-light bg-white">
      <div class="navbar-brand mx-auto">
        <img src="images/SRHPBlogo_retreat_optionB_onWhiteBg.png" alt="">
        <span class="topText text-center fw-bold h3 align-middle">GI clinical trials</span>
        
        </div>
    </nav>    
    <div id="main" class="row d-none">
      <div class="col-12 text-center">
        <button id ="btn-login" type="button" class="btn btn-outline-dark btn-lg">Login</button>
        <div id="jsonDump"></div>
      </div>
    </div>
    <footer class="border-top mt-5 mx-5"><p class="mt-3 text-center small  text-gray-400">Module version v2025.14</p>
    </footer>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  
  <!-- Auth0 Lock utilization -->
  <script>
    // Initializing our Auth0Lock
    var lock = new Auth0Lock(
      'Abvc8NGILDDu6R1iaQJ9C0tbSNVjWuJM',
      'srhpb.ca.auth0.com',
      {
        auth:{
          redirect: false, // single-page app, no redirect
          responseType: "token id_token"
        },
        allowSignUp: false, // ðŸš« hides the signup tab
        allowForgotPassword: false
      }
    );

    //Show widget
    lock.show(); 

    // When login is successful
    lock.on("authenticated", function(authResult) {
      // Save access token
      localStorage.setItem("accessToken", authResult.accessToken);

      // Show SPA content
      document.getElementById("main").classList.remove('d-none');

      // Fetch protected JSON
      fetch("/.netlify/functions/fetch-latest-json", {
        headers: {
          Authorization: `Bearer ${authResult.accessToken}`
        }
      })
      .then(res => res.json())
      .then(data => {
        document.getElementById("jsonDump").innerText = JSON.stringify(data, null, 2);
      })
      .catch(err => console.error("Error fetching data:", err));
    });

  //   var Auth = (function() {

  //   var wm = new WeakMap();
  //   var privateStore = {};
  //   var lock;

  //   function Auth() {
  //     this.lock = new Auth0Lock(
  //       'Abvc8NGILDDu6R1iaQJ9C0tbSNVjWuJM',
  //       'srhpb.ca.auth0.com'
  //     );
  //     wm.set(privateStore, {
  //       appName: "example"
  //     });
  //   }

  //   Auth.prototype.getProfile = function() {
  //     return wm.get(privateStore).profile;
  //   };

  //   Auth.prototype.authn = function() {
  //     // Listening for the authenticated event
  //     this.lock.on("authenticated", function(authResult) {
  //       // Use the token in authResult to getUserInfo() and save it if necessary
  //       this.getUserInfo(authResult.accessToken, function(error, profile) {
  //         if (error) {
  //           // Handle error
  //           return;
  //         }

  //         //we recommend not storing Access Tokens unless absolutely necessary
  //         wm.set(privateStore, {
  //           accessToken: authResult.accessToken
  //         });

  //         wm.set(privateStore, {
  //           profile: profile
  //         });

  //       });
  //     });
  //   };
  //   return Auth;
  // }());
  
  // //lock.show();
  </script>
 
</body>
 
</html>
